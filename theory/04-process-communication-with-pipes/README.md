# Тема 4. Комуникация между процеси посредством тръби (pipes)
Съдържание:

1. [](#1-)
---

## 1. Ненаименувани тръби

- Системният примитив `pipe()` се използва за създаване и отваряне на програмен канал.

- Този програмен канал е вид файл. За разлика от останалите видове файлове, той не се намира в дадена директория на файловата система (това е различно при наименуваните тръби).

- Единственият начин да го достъпвате е чрез отворените файлови дескриптори, които ще получите от системния примитив. Това означава, че програмния канал може да се използва само от процеса, който го е създал, и от създадени от него (в последствие) процеси-деца, които ще получат копия на отворените файлови дескриптори.

- Тръбата има 2 края:
    - fd[0] <- край за четене от програмния канал
    - fd[1] <- край за писане в програмния канал

- Системният примитив pipe() при успех връща 0, а  при неуспех, връща ­1. Неуспех може да възникне примерно ако заемането на още два файлови дескриптора ще доведе до нарушаване на някакво системно ограничение.

## 2. Наименувани траби

- Системният примитив `mkfifo()` (виж `man 3 mkfifo`) се използва за създаване и отваряне на програмен канал, който се запазва като файл в операционната система.

- Функционално работи по същия начин като `pipe()`, с разликата че тази траба може да се достъпва и от процеси, които не са деца на този създал тръбата (тръбата е файл във файловата система).

## 3. Дублиране на канали за комуникация
- Системните извиквания `dup`, `dup2` и `dup3` служат за създаване на копия на тръби. (виж `man 2 dup`)

- Преговор: Всяка програма има 3 файлови дескриптора отворени при стартиране - кои са те?

    <details>
    <summary>Отговор</summary>

    **STDIN_FILENO** - 0, стандартен вход
    **STDOUT_FILENO** - 1, стандартен изход
    **STDERR_FILENO** - 2, стандартен изход за грешки
    </details>

- Съответно, посредством `dup` syscall-овете, можем да пренасочим информация към STDOUT/STDERR или информация от STDIN.


## 4. Използване на каналът за комуникация
- Когато използваме програмен канал, особено за комуникация между няколко процеса, трябва много ясно да си представяме хода на данните и това кой процес какво ще прави с канала (дали ще чете или пише). 
- Добрата практика изисква всеки процес да затваря излишните му краища на програмния канал, освобождавайки заетите файлови дескриптори.

- Това е аналогично на това когато работим с друг вид файл (напр. обикновен файл) да затворим използвания файлов дескриптор.

    Пример:
    ```
    close(1);
    dup(fd[1]);
    close(fd[1]);
    close(fd[0]);
    ```
- Важно е веднага да се затварят краищата на 