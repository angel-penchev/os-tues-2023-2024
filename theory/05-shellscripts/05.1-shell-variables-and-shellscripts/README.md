# Тема 5.1. Shell променливи - дефиниране, инициализиране, присвояване. Системни променливи. Командна процедура (shell scripts)
Съдържание:

1. [Присвояване на стойност на променлива](#1-Присвояване-на-стойност-на-променлива)
2. [Извеждане на стойност на променлива](#2-извеждане-на-стойност-на-променлива)
3. [Аритметични изчисления](#3-аритметични-изчисления)
4. [Системни променливи](#4-системни-променливи)
5. [Команди за работа с променливи](#5-команди-за-работа-с-променливи)
6. [Командни процедури](#6-командни-процедури)
---

Имената на променливите в bash се състоят от букви, цифри и "_" като не могат да започват с цифра

## 1. Присвояване на стойност на променлива
- Чрез оператора за присвояване `променлива=[стойност]` /без празни пространства/.

    - Пример:
        ```
        num=12345
        str=hello
        long_str=‘This var contains intervals’
        ```

    - Ако символния низ е заграден от апострофи (' ')  се показват всички символи заедно с интервали и табулации.

    - Ако симолния низ е заграден с двойни кавички (" ")  се показват всички символи, като се подменя стойността на дадена променливa.

    - Пример:
        ```
        str=hello
        long_str=”I  welcome you with $str”
        ```

- Чрез командата `read`- `read [име/на на променлива/и]`
    - Чете се един ред от стандартния вход и се разделя на думи (разделителя е интервал) като всяка дума се съпоставя на съответната променлива.

## 2. Извеждане на стойност на променлива
- Извеждането на стойността на променливата става като поставим символа `$` пред нея.

    Пример:
    ```
    x=123
    echo $x
    name="knxxxxx"
    echo "My name is $name"
    ```

- Позволява изхода на командата да замени самата команда. За да задействаме субституцията използваме \`command\` или `$(command)`:

    Пример:
    ```
    path=`pwd` или path=$(pwd)
    name=`whoami` или name=$(whoami)
    count=`who | wc -l` или count=$(who | wc -l)
    ```

    Могат да бъдат и вложени
    ```
    num=$(ps aux | grep $(whoami) | wc -l)
    ```

## 3. Аритметични изчисления
- В bash, всички променливи се приемат за символни низове (strings). За това, аритметични изчисления се осъществяват се чрез командата `expr`.

- Изчислява се значението на подадения целочислен израз и резултатът се извежда на стандартния изход. Изразът се конструира цели числа, променливи и целочислените аритметични операции: +, -, *, /, %.

    Пример:
    ```
    expr 2 + 1 //stdout 3
    x=5
    expr $x - 1 //stdout 4
    ```

- Можем да присвояваме резултата към променливи.
    Пример:
    ```
    result=`expr 5 + 1`
    count=$(expr $(ls -l | wc -l)  - 1)
    ```

## 4. Системни променливи
- Системата има няколко вече зададени променливи, които служат при работата на системата.

- По-важни променливи:
    - `$HOME` - aбсолютният път към личната директория на потребителя
    • `$PATH` - списъкът на директориите, където се търсят командите
    • `$USER` - името на текущия потребител
    • `$SHELL` - абсолютният път на използвания команден интерпретатор
    • `$PWD` – текущата директория, в която се намираме

- Можем да дефинираме системни променливи чрез `export VARNAME=value`.

## 5. Команди за работа с променливи
- `echo` - Извежда символен низ / стойност на подадена променлива.
- `set` - Показва всички дефинирани променливи и техните стойноти.
- `unset променлива1 ...` - Изключва дадена променлива от обкръжението на процеса
- `export променлива1 ...` - Указаните променливи стават видими за процесите-деца (процесите, породени от текущия процес)

## 6. Командни процедури
- Командна процедура е поредица от команди, поместена в текстов файл.

- Най-често тези файлове имат файлово разширение `.sh`.

- Командната процедура се изпълнява в отделен subshell, който се поражда от терминала, от който е извикана.

- Когато процедурата приключи, тя има код на приключване (число от 0 до 255), като той може да бъде указан явно чрез exit код. Aко използваме exit без параметър, то кодът на завършване на КП = кода на завършване на последната изпълнена команда преди exit. Ако не е указан exit, то кодът на завършване е кодът на **последно изпълнената** команда от КП.

- Коментарите на един ред се означават с `#`.
