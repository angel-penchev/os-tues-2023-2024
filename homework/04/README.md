# Домашна работа №4

Домашна работа №4 включва работа с файловата система и sockets. Състои се от 2 задачи и има максимален брой точки 400. Оценката се изчислява по следната формула:
```
оценка = 2 + (точки / 100)
```

В заданието в Google Classroom трябва да предадете архив с име `hw03-11b-NN-Name-Surname.zip`, като замените `NN` с номера си в клас и `Name` и `Surname` с двете си имена.

Шаблон на този архив можете да изтеглите от [тук](https://github.com/angel-penchev/os-tues-2023-2024/blob/main/homework/04/hw04-11b-NN-Name-Surname.zip).

Срокът на домашната работа е **до 16.05.2024 (неделя), 23:59:59**. Допълнително, отново ще трябва да ми представите домашните си работи. Съответно, за да улесните себе си и мен, **пишете четлив и качествен код**.

---

**⚠️ ВАЖНО ⚠️**

Напомням ви, че домашното ще бъде проверявано за плагиатство! Ако ви е нужна помощ с каквото и да е - разбиране на условието, кодът и т.н., не се притеснявайте да се свържете с мен в Discord - `@justtsb` или по имейл на `angel@penchev.dev` или на `apenchev@elsys-bg.org`.


## Задача 1 - `ls` (200 точки + 75 точки бонус)
### Упътване
За решението на тази задача, може да използвате следните функции:

- `stat` - Записва информация за подаден файл (размер, id на собственика, id на групата, т.н.).
- Макросите `S_IFDIR`, `S_IFLINK`, т.н. от `sys/stat.h` - виж повече информация [тук](https://pubs.opengroup.org/onlinepubs/7908799/xsh/sysstat.h.html).
- `opendir` - Отваря към директория, името на която е подадено като аргумент, и връща указател към него.
- `readdir` - Чете подфайловете на директория.
- `closedir` - Затваря указателя отворен чрез `opendir`.
- `getpwuid` - Връща информацията за потребител по uid (user id).
- `getgrgid` - Връща информацията за група по gid (group id).
- `localtime` - Конвертира UNIX time_t структурата към четливо, локално време.

### Основна функционалност
Целта на задачате е да се реализира стандартната `UNIX` комадна `ls` с добавена функционалност.

Командата `ls` се използва за извеждане на съдържанието на директории. От командния ред програмата получава списък от имена на файлове и/или директории, а на стандартния изход извежда информация за тях. Ако подаденото име, е съществуващ файл, се извежда името му, а ако името е на директория - имената на всички файлове, съдържащи се в директорията.

Примерен изход на програмата:
```
$ ls a.txt 
a.txt
```

```
$ ls /usr/share/texmf/tex 
fontinst  
generic  
latex
```

**Забележка**: `ls` не показва скрити файлове (файлове започващи с точка - `.`).

В случай на повече от един аргумент изходът изглежда по следния начин:

```
$ ls a.txt b.txt /usr/share/texmf/tex /usr/share/texmf/metapost/
a.txt

b.txt

/usr/share/texmf/metapost/:
metauml

/usr/share/texmf/tex:
fontinst
generic
latex
```

### Поддръжка на `-A` аргумент
Командата `ls` трябва да поддържа незадължителния аргумент `-A`.

При използване на опцията `-A` командата трябва да извежда и скритите файлове без \"..\" и \".\". Например:

```
$ ls -A
a.out
a.txt
b.txt
forbidden
.hidden
main.c
```

### Поддръжка на `-l` аргумент
Командата `ls` трябва да поддържа незадължителния аргумент `-l`.

При използване на опцията `-l` командата трябва да извежда подробна
информация за файловете. Например:

```
$ ls -l
total 28
-rwxrwxr-x 1 rick rollers 8510 май 31 01:56 a.out
-rw-rw-r-- 1 rick rollers   13 май 31 01:51 a.txt
-rw-rw-r-- 1 rick rollers   27 май 31 01:51 b.txt
d--------- 2 rick rollers 4096 май 31 01:54 forbidden
-rw-rw-r-- 1 rick rollers   72 май 31 01:51 main.c
```

Прието е типовете на файловете в POSIX да се означават по следния начин:
-   обикновен файл - '-'
-   директория - 'd'
-   блоково устройство - 'b'
-   символно устройство - 'c'
-   програмен поток - 'p'
-   символна връзка - 'l'
-   сокет - 's'

След типа се изписват правата на собственика, правата на групата собственик и правата на всички останали. След това се изписват броят на силните връзки към файла (hard links), собственика (име или uid, ако името не е налично), групата (име или gid, ако името не е налечно), размер, дата на последна промяна и самото име на файла.

### Комбинация от опции
Възможна е произволна комбинация от опции. Например: `ls -lА`, `ls -Аl`, `ls -l -A` и т.н.

### Обработка на грешки
Ако някой от аргументите на `ls` не е файл или директория, то програмата трябва да изведе съобщение на стандартната грешка (`stderr`). Например, ако бъдат предадени аргументи, които не са файлове, то съобщението трябва да бъде оформено по следния начин:

```
$ ls aa
ls: cannot access 'aa': No such file or directory
```

Ако на програмата се предаде име на директория, която потребителят няма права да отвори, то съобщението трябва да бъде оформено по следния начин:

```
$ ls forbidden/
ls: cannot open directory 'forbidden/': Permission denied
```

### (Бонус) Поддръжка на `-R` аргумент
Командата `ls` да поддържа незадължителния аргумент `-R`. При използване на опцията `-R` командата трябва при обработване на директории да ги обхожда рекурсивно. При примерна файлова структура:

```
.
|-- a.out
|-- a.txt
|-- b.txt
|-- dir1
|  |-- dir11
|  |-- file01.txt
|-- dir2
|-- dir3
```

резултатът от изпълнението на програмата трябва да е:

```
$ ls -R

.:
a.out
a.txt
b.txt
dir1
dir2
dir3

./dir1:
dir11
file01.txt

./dir1/dir11:

./dir2:

./dir3:
```


## Задача 2 - `downloader` (200 точки + 50 точки бонус)
### Основна функционалност
В тази задача ще трябва да реализирате 2 програми - сървър и клиент. Сървърът трябва да има IPv4 адрес и да комуникира чрез TCP. Съответно, при установена връзка от клиента, сървъра трябва да изпрати съдържанието на изображението `image.png`, което ще намерите [тук](https://github.com/angel-penchev/os-tues-2023-2024/tree/main/homework/04/hw04-11b-NN-Name-Surname/02-downloader) (и в template `.zip` файла).

При стартиране на клиента, той трябва да останови връзка със сървъра (да се изпише грешка, ако това е невъзможно). Съответно, клиентът трябва да прочете полученото изображение и да го запише локално.

### Обслужване на много клиенти

За да получите пълният брой точки, сървърът трябва да може да обработва няколко клиента наведнъж. Това може да се случва посредством нишки или отделни процеси за всяка клиентска връзка.

### (Бонус) Поддръжка за заявки за определен файл
Клиентът да се разшири с функционалността да получава команден аргумент - име на файл от сървъра:

```sh
./downloader-client custom-file.mp4
```

Съответно, сървърът трябва да може да предостави този файл на клиента. Ако файл с това име не съществува, клиентът трябва да се уведоми с подходящо съобщение за грешка.
